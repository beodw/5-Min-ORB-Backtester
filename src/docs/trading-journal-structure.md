# Trading Journal Data Structure for Analysis

This document outlines the structure of the data as it is stored in your Firebase Firestore database. Understanding this structure is essential for performing meaningful analysis on your backtested trades.

## High-Level Structure: Firestore

Your trading journal data is organized within Firestore, a NoSQL cloud database. The structure is designed to be both scalable and easy to query.

-   **Collection**: All trade data is stored in a single top-level collection named `trades`. A collection is simply a container for documents.

-   **Documents**: Each individual trade you log from the application is stored as a separate **document** within the `trades` collection. The unique ID for each document is automatically generated by Firestore. This means that one complete trade, from entry to exit, is a single, self-contained unit in the database.

## Trade Document Fields

Each document within the `trades` collection contains several fields that describe the trade's parameters and its entire lifecycle.

| Field Name      | Data Type            | Description                                                                                                                                      |
| :-------------- | :------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------- |
| `tradeId`       | `string`             | A unique identifier for the trade, generated from the entry timestamp (e.g., `"2024-09-03T18:30:00.000Z"`).                                    |
| `entryPrice`    | `number`             | The price at which the trade was entered.                                                                                                        |
| `stopLossPrice` | `number`             | The price at which the stop loss was set for this trade.                                                                                         |
| `createdAt`     | `Firestore Timestamp`| A server-generated timestamp indicating exactly when the trade document was written to the database.                                               |
| `entryDate`     | `Firestore Timestamp`| The precise timestamp for when the trade was initiated on the chart.                                                                               |
| `log`           | `array`              | An array of objects, where each object represents one candle (or time interval, e.g., 1 minute) in the life of the trade. See details below.        |

### The `log` Array: The Heart of the Analysis

The `log` field is an array that contains a chronological record of the trade's performance, candle by candle. Each entry in the array is an object with the following structure:

| Field Name           | Data Type | Description                                                                                                   |
| :------------------- | :-------- | :------------------------------------------------------------------------------------------------------------ |
| `Timestamp`          | `string`  | The ISO 8601 timestamp for that specific candle (e.g., `"2024-09-03T18:31:00.000Z"`).                          |
| `CandleNumber`       | `number`  | The sequence number of the candle since the trade entry (e.g., `1`, `2`, `3`, ...).                            |
| `CurrentPrice_Close` | `number`  | The closing price of the instrument at the end of this candle.                                                |
| `MFE_R`              | `number`  | **Maximum Favorable Excursion (in R-multiples)**. The peak profit the trade reached, measured in multiples of the initial risk. |
| `MAE_R`              | `number`  | **Maximum Adverse Excursion (in R-multiples)**. The maximum unrealized loss (drawdown) the trade experienced, measured in multiples of initial risk. |
| `DrawdownFromMFE_R`  | `number`  | The drawdown from the peak profit (MFE), measured in R-multiples. This is crucial for analyzing trail-stop strategies. |
| `Trade Status`       | `string`  | The status of the trade at this candle. It will be `"Active"`, `"StopLoss"` (if the SL was hit), or `"EndOfData"` (if the trade was still active when the data ran out). |

### Nuances for Analysis

To get the most out of this data, consider the following:

1.  **Risk (R) Is the Unit of Measurement**: The key performance metrics (`MFE_R`, `MAE_R`, `DrawdownFromMFE_R`) are normalized by risk. **Risk (R)** is defined as the absolute difference between the `entryPrice` and the `stopLossPrice`. This is a powerful concept because it allows you to compare the performance of different trades on an equal footing, regardless of the instrument's volatility or the trade's size.

2.  **Analyzing MFE (Maximum Favorable Excursion)**: By analyzing the distribution of `MFE_R` across all your trades, you can answer questions like, "What is the most profit my strategy typically generates?" or "Is my take-profit target of 3R realistic, or do most of my trades only reach 1.5R?" This is invaluable for optimizing profit targets.

3.  **Analyzing MAE (Maximum Adverse Excursion)**: MAE tells you how much "pain" you had to endure for a winning trade. If you find that your winning trades consistently have a high MAE (e.g., 0.8R), it might indicate your stop loss is too tight. Conversely, if MAE is always very low, your stop loss might be too wide, and you could be giving up profit.

4.  **Analyzing Drawdown from MFE (A Deep Dive)**: This is a sophisticated metric for testing trailing stop strategies. It measures how much profit a trade gives back *after* it has reached its peak profit.
    *   **How it's Calculated**: At every candle, the system knows the highest price the trade has reached so far (the `mfePrice`). It then calculates the difference between that peak price and the current candle's closing price. This difference is then divided by the initial risk to normalize it into an R-multiple.
    *   **Example**: Your long trade enters at $100 with a stop at $98 (1R = $2). The price rises to a high of $105 (MFE = 2.5R). On the next candle, it pulls back and closes at $103. The drawdown from the peak is $2 ($105 - $103). The `DrawdownFromMFE_R` for this candle is **1.0R** ($2 drawdown / $2 risk).
    *   **Why it's Crucial**: By analyzing the `DrawdownFromMFE_R` for all your winning trades, you can find the optimal distance for a trailing stop. If you see that your best trades often pull back 0.7R before continuing higher, setting a 0.5R trailing stop is likely cutting your winners short. This metric allows you to quantify your strategy's "breathing room" and tailor your exit logic to its specific behavior.
```